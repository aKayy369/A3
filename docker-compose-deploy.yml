version: '3.9'

services:
  dash:
    # ğŸ§  Command to start your Dash app
    command: python3 app.py

    # ğŸ³ Image built & pushed to Docker Hub
    image: anubhavkharel01/a3-app:latest

    # ğŸŒ Expose the app on port 80 inside container
    ports:
      - "8060:80"

    # ğŸ” Environment variables for MLflow connection
    environment:
      - HOST=0.0.0.0
      - PORT=80
      - MLFLOW_TRACKING_URI=https://mlflow.ml.brain.cs.ait.ac.th
      - MLFLOW_TRACKING_USERNAME=admin
      - MLFLOW_TRACKING_PASSWORD=password
      - APP_MODEL_NAME=st125999-a3-model

    # ğŸ·ï¸ Traefik labels to route your app
    labels:
      # Enable Traefik
      - traefik.enable=true

      # ğŸ”Œ Internal port Dash runs on
      - traefik.http.services.dash-st125999.loadbalancer.server.port=80  

      # ğŸŒ Domain: <service>-<studentID>.ml.brain.cs.ait.ac.th
      - traefik.http.routers.dash-st125999.rule=Host(`st125999.ml.brain.cs.ait.ac.th`)

      # ğŸ”’ Enable HTTPS
      - traefik.http.routers.dash-st125999.tls=true
      - traefik.http.routers.dash-st125999.tls.certresolver=production
      - traefik.http.routers.dash-st125999.entrypoints=websecure

    # ğŸ” Always restart on failure
    restart: always

    # ğŸŒ Networks
    networks:
      - default
      - traefik_default

# ğŸ•¸ï¸ Networks: keep default and connect to Traefik
networks:
  default:
  traefik_default:
    external: true

